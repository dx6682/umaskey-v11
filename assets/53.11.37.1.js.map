{"version":3,"sources":["webpack:///./src/client/app/common/views/components/autocomplete.vue?0685","webpack:///./src/client/app/common/views/components/autocomplete.vue?235b","webpack:///./src/client/app/common/views/components/autocomplete.vue?84a6","webpack:///./src/client/app/common/views/components/autocomplete.vue","webpack:///./src/client/app/common/scripts/contains.ts","webpack:///./src/client/app/common/views/components/autocomplete.vue?c986","webpack:///./src/client/app/common/views/components/autocomplete.vue?51d8","webpack:///./src/client/app/common/views/components/autocomplete.vue?8eef"],"names":["lib","emojilist","filter","x","category","char2file","char","codes","Array","from","map","codePointAt","toString","includes","length","join","emjdb","emoji","name","aliasOf","url","keywords","k","push","sort","a","b","extend","props","type","String","required","q","textarea","Object","complete","Function","close","Number","y","data","getStaticImageUrl","fetching","users","hashtags","emojis","select","emojiDb","computed","items","this","$refs","suggests","children","useOsDefaultEmojis","$store","state","device","updated","$el","offsetWidth","window","innerWidth","style","left","offsetHeight","innerHeight","top","marginTop","mounted","customEmojis","$root","getMetaSync","emojiDefinitions","isCustomEmoji","aliases","alias","concat","addEventListener","onKeydown","el","document","querySelectorAll","onMousedown","$nextTick","exec","$watch","beforeDestroy","removeEventListener","methods","removeAttribute","cacheKey","cache","sessionStorage","getItem","JSON","parse","api","query","limit","detail","then","setItem","stringify","localStorage","textA","toUpperCase","textB","matched","max","some","startsWith","e","contains","target","cancel","preventDefault","stopPropagation","which","click","selectPrev","selectNext","focus","applySelect","setAttribute","component","_vm","_h","$createElement","_c","_self","staticClass","on","$event","ref","_l","user","attrs","avatarUrl","key","id","_v","_s","_f","_e","hashtag","disableShowingAnimatedImages","domProps","replace","node","child","parentNode","parent","content","module","i","locals","exports","add","default","___CSS_LOADER_API_IMPORT___"],"mappings":"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","file":"53.11.37.1.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"mk-autocomplete\",on:{\"contextmenu\":function($event){$event.preventDefault();return (function () {})($event)}}},[(_vm.users.length > 0)?_c('ol',{ref:\"suggests\",staticClass:\"users\"},_vm._l((_vm.users),function(user){return _c('li',{attrs:{\"tabindex\":\"-1\"},on:{\"click\":function($event){return _vm.complete(_vm.type, user)},\"keydown\":_vm.onKeydown}},[_c('img',{staticClass:\"avatar\",attrs:{\"src\":user.avatarUrl,\"alt\":\"\"}}),_c('span',{staticClass:\"name\"},[_c('mk-user-name',{key:user.id,attrs:{\"user\":user}})],1),_c('span',{staticClass:\"username\"},[_vm._v(\"@\"+_vm._s(_vm._f(\"acct\")(user)))])])}),0):_vm._e(),(_vm.hashtags.length > 0)?_c('ol',{ref:\"suggests\",staticClass:\"hashtags\"},_vm._l((_vm.hashtags),function(hashtag){return _c('li',{attrs:{\"tabindex\":\"-1\"},on:{\"click\":function($event){return _vm.complete(_vm.type, hashtag)},\"keydown\":_vm.onKeydown}},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(hashtag))])])}),0):_vm._e(),(_vm.emojis.length > 0)?_c('ol',{ref:\"suggests\",staticClass:\"emojis\"},_vm._l((_vm.emojis),function(emoji){return _c('li',{attrs:{\"tabindex\":\"-1\"},on:{\"click\":function($event){return _vm.complete(_vm.type, emoji.emoji)},\"keydown\":_vm.onKeydown}},[(emoji.isCustomEmoji)?_c('span',{staticClass:\"emoji\"},[_c('img',{attrs:{\"src\":_vm.$store.state.device.disableShowingAnimatedImages ? _vm.getStaticImageUrl(emoji.url) : emoji.url,\"alt\":emoji.emoji}})]):(!_vm.useOsDefaultEmojis)?_c('span',{staticClass:\"emoji\"},[_c('img',{attrs:{\"src\":emoji.url,\"alt\":emoji.emoji}})]):_c('span',{staticClass:\"emoji\"},[_vm._v(_vm._s(emoji.emoji))]),_c('span',{staticClass:\"name\",domProps:{\"innerHTML\":_vm._s(emoji.name.replace(_vm.q, (\"<b>\" + _vm.q + \"</b>\")))}}),(emoji.aliasOf)?_c('span',{staticClass:\"alias\"},[_vm._v(\"(\"+_vm._s(emoji.aliasOf)+\")\")]):_vm._e()])}),0):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue';\nimport { emojilist } from '../../../../../misc/emojilist';\nimport contains from '../../../common/scripts/contains';\nimport { twemojiSvgBase } from '../../../../../misc/twemoji-base';\nimport { getStaticImageUrl } from '../../../common/scripts/get-static-image-url';\nconst lib = emojilist.filter(x => x.category !== 'flags');\nconst char2file = (char) => {\n    let codes = Array.from(char).map(x => x.codePointAt(0).toString(16));\n    if (!codes.includes('200d'))\n        codes = codes.filter(x => x != 'fe0f');\n    codes = codes.filter(x => x && x.length);\n    return codes.join('-');\n};\nconst emjdb = lib.map(x => ({\n    emoji: x.char,\n    name: x.name,\n    aliasOf: null,\n    url: `${twemojiSvgBase}/${char2file(x.char)}.svg`\n}));\nfor (const x of lib) {\n    if (x.keywords) {\n        for (const k of x.keywords) {\n            emjdb.push({\n                emoji: x.char,\n                name: k,\n                aliasOf: x.name,\n                url: `${twemojiSvgBase}/${char2file(x.char)}.svg`\n            });\n        }\n    }\n}\nemjdb.sort((a, b) => a.name.length - b.name.length);\nexport default Vue.extend({\n    props: {\n        type: {\n            type: String,\n            required: true,\n        },\n        q: {\n            type: String,\n            required: true,\n        },\n        textarea: {\n            type: Object,\n            required: true,\n        },\n        complete: {\n            type: Function,\n            required: true,\n        },\n        close: {\n            type: Function,\n            required: true,\n        },\n        x: {\n            type: Number,\n            required: true,\n        },\n        y: {\n            type: Number,\n            required: true,\n        },\n    },\n    data() {\n        return {\n            getStaticImageUrl,\n            fetching: true,\n            users: [],\n            hashtags: [],\n            emojis: [],\n            select: -1,\n            emojilist,\n            emojiDb: []\n        };\n    },\n    computed: {\n        items() {\n            return this.$refs.suggests.children;\n        },\n        useOsDefaultEmojis() {\n            return this.$store.state.device.useOsDefaultEmojis;\n        }\n    },\n    updated() {\n        //#region 位置調整\n        if (this.x + this.$el.offsetWidth > window.innerWidth) {\n            this.$el.style.left = (window.innerWidth - this.$el.offsetWidth) + 'px';\n        }\n        else {\n            this.$el.style.left = this.x + 'px';\n        }\n        if (this.y + this.$el.offsetHeight > window.innerHeight) {\n            this.$el.style.top = (this.y - this.$el.offsetHeight) + 'px';\n            this.$el.style.marginTop = '0';\n        }\n        else {\n            this.$el.style.top = this.y + 'px';\n            this.$el.style.marginTop = 'calc(1em + 8px)';\n        }\n        //#endregion\n    },\n    mounted() {\n        //#region Construct Emoji DB\n        const customEmojis = (this.$root.getMetaSync() || { emojis: [] }).emojis || [];\n        const emojiDefinitions = [];\n        for (const x of customEmojis) {\n            emojiDefinitions.push({\n                name: x.name,\n                emoji: `:${x.name}:`,\n                url: x.url,\n                isCustomEmoji: true\n            });\n            if (x.aliases) {\n                for (const alias of x.aliases) {\n                    emojiDefinitions.push({\n                        name: alias,\n                        aliasOf: x.name,\n                        emoji: `:${x.name}:`,\n                        url: x.url,\n                        isCustomEmoji: true\n                    });\n                }\n            }\n        }\n        emojiDefinitions.sort((a, b) => a.name.length - b.name.length);\n        this.emojiDb = emojiDefinitions.concat(emjdb);\n        //#endregion\n        this.textarea.addEventListener('keydown', this.onKeydown);\n        for (const el of Array.from(document.querySelectorAll('body *'))) {\n            el.addEventListener('mousedown', this.onMousedown);\n        }\n        this.$nextTick(() => {\n            this.exec();\n            this.$watch('q', () => {\n                this.$nextTick(() => {\n                    this.exec();\n                });\n            });\n        });\n    },\n    beforeDestroy() {\n        this.textarea.removeEventListener('keydown', this.onKeydown);\n        for (const el of Array.from(document.querySelectorAll('body *'))) {\n            el.removeEventListener('mousedown', this.onMousedown);\n        }\n    },\n    methods: {\n        exec() {\n            this.select = -1;\n            if (this.$refs.suggests) {\n                for (const el of Array.from(this.items)) {\n                    el.removeAttribute('data-selected');\n                }\n            }\n            if (this.type == 'user') {\n                const cacheKey = `autocomplete:user:${this.q}`;\n                const cache = sessionStorage.getItem(cacheKey);\n                if (cache) {\n                    const users = JSON.parse(cache);\n                    this.users = users;\n                    this.fetching = false;\n                }\n                else {\n                    this.$root.api('users/search', {\n                        query: this.q,\n                        limit: 10,\n                        detail: false\n                    }).then(users => {\n                        this.users = users;\n                        this.fetching = false;\n                        // キャッシュ\n                        sessionStorage.setItem(cacheKey, JSON.stringify(users));\n                    });\n                }\n            }\n            else if (this.type == 'hashtag') {\n                if (this.q == null || this.q == '') {\n                    this.hashtags = JSON.parse(localStorage.getItem('hashtags') || '[]');\n                    this.fetching = false;\n                }\n                else {\n                    const cacheKey = `autocomplete:hashtag:${this.q}`;\n                    const cache = sessionStorage.getItem(cacheKey);\n                    if (cache) {\n                        const hashtags = JSON.parse(cache);\n                        this.hashtags = hashtags;\n                        this.fetching = false;\n                    }\n                    else {\n                        this.$root.api('hashtags/search', {\n                            query: this.q,\n                            limit: 30\n                        }).then(hashtags => {\n                            this.hashtags = hashtags;\n                            this.fetching = false;\n                            // キャッシュ\n                            sessionStorage.setItem(cacheKey, JSON.stringify(hashtags));\n                        });\n                    }\n                }\n            }\n            else if (this.type == 'emoji') {\n                if (this.q == null || this.q == '') {\n                    this.emojis = this.emojiDb.filter(x => x.isCustomEmoji && !x.aliasOf).sort((a, b) => {\n                        var textA = a.name.toUpperCase();\n                        var textB = b.name.toUpperCase();\n                        return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;\n                    });\n                    return;\n                }\n                const matched = [];\n                const max = 30;\n                this.emojiDb.some(x => {\n                    if (x.name.startsWith(this.q) && !x.aliasOf && !matched.some(y => y.emoji == x.emoji))\n                        matched.push(x);\n                    return matched.length == max;\n                });\n                if (matched.length < max) {\n                    this.emojiDb.some(x => {\n                        if (x.name.startsWith(this.q) && !matched.some(y => y.emoji == x.emoji))\n                            matched.push(x);\n                        return matched.length == max;\n                    });\n                }\n                if (matched.length < max) {\n                    this.emojiDb.some(x => {\n                        if (x.name.includes(this.q) && !matched.some(y => y.emoji == x.emoji))\n                            matched.push(x);\n                        return matched.length == max;\n                    });\n                }\n                this.emojis = matched;\n            }\n        },\n        onMousedown(e) {\n            if (!contains(this.$el, e.target) && (this.$el != e.target))\n                this.close();\n        },\n        onKeydown(e) {\n            const cancel = () => {\n                e.preventDefault();\n                e.stopPropagation();\n            };\n            switch (e.which) {\n                case 10: // [ENTER]\n                case 13: // [ENTER]\n                    if (this.select !== -1) {\n                        cancel();\n                        this.items[this.select].click();\n                    }\n                    else {\n                        this.close();\n                    }\n                    break;\n                case 27: // [ESC]\n                    cancel();\n                    this.close();\n                    break;\n                case 38: // [↑]\n                    if (this.select !== -1) {\n                        cancel();\n                        this.selectPrev();\n                    }\n                    else {\n                        this.close();\n                    }\n                    break;\n                case 9: // [TAB]\n                case 40: // [↓]\n                    cancel();\n                    this.selectNext();\n                    break;\n                default:\n                    e.stopPropagation();\n                    this.textarea.focus();\n            }\n        },\n        selectNext() {\n            if (++this.select >= this.items.length)\n                this.select = 0;\n            this.applySelect();\n        },\n        selectPrev() {\n            if (--this.select < 0)\n                this.select = this.items.length - 1;\n            this.applySelect();\n        },\n        applySelect() {\n            for (const el of Array.from(this.items)) {\n                el.removeAttribute('data-selected');\n            }\n            this.items[this.select].setAttribute('data-selected', 'true');\n            this.items[this.select].focus();\n        }\n    }\n});\n","import mod from \"-!../../../../../../node_modules/ts-loader/index.js??ref--5-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../../../node_modules/ts-loader/index.js??ref--5-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./autocomplete.vue?vue&type=template&id=3e59c218&scoped=true&\"\nimport script from \"./autocomplete.vue?vue&type=script&lang=ts&\"\nexport * from \"./autocomplete.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./autocomplete.vue?vue&type=style&index=0&id=3e59c218&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3e59c218\",\n  null\n  \n)\n\nexport default component.exports","export default (parent, child) => {\n    let node = child.parentNode;\n    while (node) {\n        if (node == parent)\n            return true;\n        node = node.parentNode;\n    }\n    return false;\n};\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--1-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=style&index=0&id=3e59c218&lang=stylus&scoped=true&\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"8c034bc6\", content, true, {});","import mod from \"-!../../../../../../node_modules/vue-style-loader/index.js!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--1-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=style&index=0&id=3e59c218&lang=stylus&scoped=true&\"; export default mod; export * from \"-!../../../../../../node_modules/vue-style-loader/index.js!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--1-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./autocomplete.vue?vue&type=style&index=0&id=3e59c218&lang=stylus&scoped=true&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".mk-autocomplete[data-v-3e59c218]{position:fixed;z-index:65535;max-width:100%;margin-top:calc(1em + 8px);overflow:hidden;background:var(--faceHeader);border:1px solid rgba(0,0,0,.1);border-radius:4px;transition:top .1s ease,left .1s ease}.mk-autocomplete>ol[data-v-3e59c218]{display:block;margin:0;padding:4px 0;max-height:190px;max-width:500px;overflow:auto;list-style:none}.mk-autocomplete>ol>li[data-v-3e59c218]{display:flex;align-items:center;padding:4px 12px;white-space:nowrap;overflow:hidden;font-size:.9em;color:rgba(0,0,0,.8);cursor:default}.mk-autocomplete>ol>li[data-v-3e59c218],.mk-autocomplete>ol>li *[data-v-3e59c218]{user-select:none}.mk-autocomplete>ol>li *[data-v-3e59c218]{overflow:hidden;text-overflow:ellipsis}.mk-autocomplete>ol>li[data-v-3e59c218]:hover{background:var(--autocompleteItemHoverBg)}.mk-autocomplete>ol>li[data-selected=true][data-v-3e59c218]{background:var(--primary)}.mk-autocomplete>ol>li[data-selected=true][data-v-3e59c218],.mk-autocomplete>ol>li[data-selected=true] *[data-v-3e59c218]{color:#fff!important}.mk-autocomplete>ol>li[data-v-3e59c218]:active{background:var(--primaryDarken10)}.mk-autocomplete>ol>li[data-v-3e59c218]:active,.mk-autocomplete>ol>li:active *[data-v-3e59c218]{color:#fff!important}.mk-autocomplete>.users>li .avatar[data-v-3e59c218]{min-width:28px;min-height:28px;max-width:28px;max-height:28px;margin:0 8px 0 0;border-radius:100%}.mk-autocomplete>.users>li .name[data-v-3e59c218]{margin:0 8px 0 0;color:var(--autocompleteItemText)}.mk-autocomplete>.users>li .username[data-v-3e59c218]{color:var(--autocompleteItemTextSub)}.mk-autocomplete>.hashtags>li .name[data-v-3e59c218]{color:var(--autocompleteItemText)}.mk-autocomplete>.emojis>li .emoji[data-v-3e59c218]{display:inline-block;margin:0 4px 0 0;width:24px}.mk-autocomplete>.emojis>li .emoji>img[data-v-3e59c218]{width:24px;vertical-align:bottom}.mk-autocomplete>.emojis>li .name[data-v-3e59c218]{color:var(--autocompleteItemText)}.mk-autocomplete>.emojis>li .alias[data-v-3e59c218]{margin:0 0 0 8px;color:var(--autocompleteItemTextSub)}\", \"\"]);\n// Exports\nmodule.exports = exports;\n"],"sourceRoot":""}